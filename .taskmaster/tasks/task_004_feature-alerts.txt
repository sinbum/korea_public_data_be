# Task ID: 4
# Title: API 초안: 구독 CRUD, 매칭 미리보기, 알림 기록 조회
# Status: in-progress
# Dependencies: 1, 2, 3
# Priority: medium
# Description: 알림 구독 관리, 매칭 미리보기 기능, 알림 전송 기록 조회를 위한 RESTful API 엔드포인트를 구현하고 인증, 버전 관리, 표준 응답 형식을 적용합니다.
# Details:
1. 구독 CRUD API 구현:
- POST /api/v1/subscriptions: 새 알림 구독 생성
- GET /api/v1/subscriptions: 사용자별 구독 목록 조회
- PUT /api/v1/subscriptions/:id: 구독 설정 수정
- DELETE /api/v1/subscriptions/:id: 구독 비활성화
- Joi 스키마를 통한 요청 데이터 검증
- MongoDB 쿼리 최적화 및 페이징 처리

2. 매칭 미리보기 API 구현:
- GET /api/v1/subscriptions/:id/preview: 구독 조건에 매칭되는 문서 미리보기
- 매칭 엔진을 활용한 실시간 검색 결과 제공
- 페이징과 정렬 옵션 지원 (limit=10, sort=relevance)
- 캐싱을 통한 성능 최적화 (Redis, TTL=5분)

3. 알림 기록 조회 API 구현:
- GET /api/v1/notifications: 사용자별 알림 전송 기록
- 필터링 옵션: status, type, dateRange, subscriptionId
- 전송 상태별 통계 제공: sent, failed, pending 카운트
- 페이징 처리 및 날짜 범위 검색

4. 인증 시스템 적용:
- JWT 토큰 기반 인증 미들웨어
- 사용자별 리소스 접근 권한 검증
- Rate limiting: IP당 분당 100회 제한

5. API 버전 관리 및 표준 응답:
- /api/v1/ 네임스페이스 적용
- 표준 응답 형식: { success, data, error, pagination, timestamp }
- HTTP 상태 코드 표준화: 200(성공), 400(잘못된 요청), 401(인증 실패), 404(리소스 없음), 500(서버 오류)
- OpenAPI 3.0 스펙 문서 생성

# Test Strategy:
1. 구독 CRUD API 테스트:
- 각 엔드포인트별 정상 케이스 및 에러 케이스 검증
- 요청 데이터 검증 로직 테스트 (필수 필드, 데이터 타입)
- 권한 검증: 다른 사용자의 구독에 접근 시 403 에러 반환 확인

2. 매칭 미리보기 API 테스트:
- 구독 조건에 맞는 문서가 올바르게 매칭되는지 검증
- 페이징 및 정렬 동작 확인
- 캐시 적중률 및 응답 시간 측정 (목표: 200ms 이하)

3. 알림 기록 조회 API 테스트:
- 사용자별 알림 기록 필터링 정확성 검증
- 날짜 범위 검색 및 상태별 필터링 동작 확인
- 통계 데이터 정확성 검증

4. 인증 및 보안 테스트:
- 유효하지 않은 토큰으로 API 호출 시 401 에러 반환 확인
- Rate limiting 동작 검증: 제한 초과 시 429 에러 반환
- CORS 설정 및 보안 헤더 적용 확인

5. API 표준화 테스트:
- 모든 응답이 표준 형식을 따르는지 검증
- HTTP 상태 코드가 올바르게 설정되는지 확인
- OpenAPI 문서와 실제 API 동작 일치성 검증

# Subtasks:
## 1. 조건부 라우터 마운트 [done]
### Dependencies: None
### Description: ALERTS_ENABLED일 때만 /api/v1/alerts 라우터 장착
### Details:


