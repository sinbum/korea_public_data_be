# Task ID: 5
# Title: 운영/보안 가드레일: 전송 스로틀링, 일일 상한, 관측성 메트릭, 메일 도메인 인증 가이드
# Status: pending
# Dependencies: 3, 4
# Priority: low
# Description: 알림 전송 시스템의 안정적인 운영을 위한 스로틀링, 상한 제한, 모니터링 메트릭, 보안 가이드를 구현합니다.
# Details:
1. 전송 스로틀링 시스템 구현:
- Redis를 활용한 sliding window rate limiting (분당 100건, 시간당 1000건)
- Celery 작업 레벨에서 rate_limit 데코레이터 적용
- 사용자별/채널별 독립적인 스로틀링 정책 설정
- 스로틀링 초과 시 exponential backoff와 재시도 큐 관리

2. 일일 전송 상한 시스템:
- daily_limits 컬렉션: userId별 일일 전송 카운터 및 제한값 관리
- 자정 UTC 기준 카운터 리셋 스케줄링
- 상한 도달 시 알림 중단 및 사용자 통지 로직
- 관리자 대시보드에서 사용자별 상한 조정 기능

3. 관측성 메트릭 시스템:
- Prometheus 메트릭 수집: 전송 성공률, 응답 시간, 큐 길이, 에러율
- Grafana 대시보드: 실시간 모니터링 및 알림 설정
- 로그 집계: ELK 스택을 통한 에러 로그 분석 및 패턴 탐지
- 헬스체크 엔드포인트: /api/health에서 시스템 상태 점검

4. 메일 도메인 인증 가이드 문서:
- SPF, DKIM, DMARC 설정 가이드 작성
- 도메인 평판 관리 및 블랙리스트 회피 방법
- AWS SES 설정 및 bounce/complaint 처리 가이드
- 이메일 전송 모범 사례 및 컴플라이언스 체크리스트

# Test Strategy:
1. 스로틀링 테스트:
- 분당 제한을 초과하는 요청 시 429 에러 반환 확인
- 시간 윈도우 슬라이딩 동작 검증
- 서로 다른 사용자 간 독립적인 스로틀링 확인

2. 일일 상한 테스트:
- 사용자별 일일 전송 카운터 정확성 검증
- 상한 도달 시 전송 중단 및 사용자 알림 동작 확인
- 자정 카운터 리셋 스케줄링 정확성 테스트

3. 메트릭 수집 테스트:
- Prometheus 엔드포인트에서 메트릭 노출 확인
- 전송 성공/실패 시 메트릭 카운터 증가 검증
- Grafana 대시보드에서 실시간 데이터 표시 확인

4. 보안 가이드 검증:
- SPF/DKIM/DMARC 레코드 설정 후 이메일 인증 성공 확인
- 테스트 이메일의 스팸 점수 측정 (SpamAssassin)
- AWS SES bounce/complaint 핸들링 동작 테스트
