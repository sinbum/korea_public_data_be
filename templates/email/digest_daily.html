{% extends "email/base.html" %}

{% block title %}ì¼ê°„ ë‹¤ì´ì œìŠ¤íŠ¸ - í•œêµ­ ê³µê³µë°ì´í„°{% endblock %}

{% block header %}ğŸ“° ì˜¤ëŠ˜ì˜ ê³µê³  ë‹¤ì´ì œìŠ¤íŠ¸{% endblock %}

{% block content %}
<h2>ì•ˆë…•í•˜ì„¸ìš”, {{ user_name }}ë‹˜!</h2>

<p>{{ date.strftime('%Yë…„ %mì›” %dì¼ %A') }} ê¸°ì¤€ìœ¼ë¡œ íšŒì›ë‹˜ì˜ ê´€ì‹¬ ë¶„ì•¼ì— ìƒˆë¡œ ë“±ë¡ëœ ê³µê³ ì™€ ë§ˆê° ì„ë°• ê³µê³ ë¥¼ ëª¨ì•„ì„œ ì „í•´ë“œë¦½ë‹ˆë‹¤.</p>

{% if new_announcements %}
<h3>ğŸ†• ìƒˆë¡œ ë“±ë¡ëœ ê³µê³  ({{ new_announcements|length }}ê±´)</h3>
{% for announcement in new_announcements %}
<div class="alert-info" style="margin: 15px 0;">
    <table style="width: 100%; border-collapse: collapse;">
        <tr>
            <td style="padding: 0; vertical-align: top; width: 70%;">
                <h4 style="margin: 0 0 8px 0; color: #1f2937; font-size: 16px;">
                    <a href="{{ announcement.url }}" style="color: #2563eb; text-decoration: none;">
                        {{ announcement.title }}
                    </a>
                </h4>
                <p style="margin: 0 0 5px 0; color: #6b7280; font-size: 14px;">
                    {{ announcement.organization }} | {{ announcement.category or 'ë¯¸ë¶„ë¥˜' }}
                </p>
                {% if announcement.summary %}
                <p style="margin: 5px 0 0 0; color: #4b5563; font-size: 14px; line-height: 1.4;">
                    {{ announcement.summary[:100] }}{% if announcement.summary|length > 100 %}...{% endif %}
                </p>
                {% endif %}
            </td>
            <td style="padding: 0 0 0 15px; vertical-align: top; text-align: right; width: 30%;">
                <div style="background-color: #eff6ff; padding: 8px 12px; border-radius: 4px; font-size: 12px;">
                    {% if announcement.application_end_date %}
                    <div style="color: #1e40af; font-weight: bold;">
                        {{ announcement.application_end_date.strftime('%m/%d') }} ë§ˆê°
                    </div>
                    {% endif %}
                    {% if announcement.match_score %}
                    <div style="color: #2563eb; margin-top: 3px;">
                        ë§¤ì¹­: {{ "%.0f" | format(announcement.match_score * 100) }}%
                    </div>
                    {% endif %}
                </div>
            </td>
        </tr>
    </table>
</div>
{% endfor %}
{% endif %}

{% if deadline_announcements %}
<h3>â° ë§ˆê° ì„ë°• ê³µê³  ({{ deadline_announcements|length }}ê±´)</h3>
{% for announcement in deadline_announcements %}
<div style="background-color: {% if announcement.days_left <= 1 %}#fef2f2{% elif announcement.days_left <= 3 %}#fef3c7{% else %}#eff6ff{% endif %}; border-left: 4px solid {% if announcement.days_left <= 1 %}#dc2626{% elif announcement.days_left <= 3 %}#d97706{% else %}#2563eb{% endif %}; padding: 15px; margin: 15px 0;">
    <table style="width: 100%; border-collapse: collapse;">
        <tr>
            <td style="padding: 0; vertical-align: top; width: 70%;">
                <h4 style="margin: 0 0 8px 0; color: #1f2937; font-size: 16px;">
                    <a href="{{ announcement.url }}" style="color: {% if announcement.days_left <= 1 %}#dc2626{% elif announcement.days_left <= 3 %}#d97706{% else %}#2563eb{% endif %}; text-decoration: none;">
                        {{ announcement.title }}
                    </a>
                </h4>
                <p style="margin: 0; color: #6b7280; font-size: 14px;">
                    {{ announcement.organization }} | {{ announcement.category or 'ë¯¸ë¶„ë¥˜' }}
                </p>
            </td>
            <td style="padding: 0 0 0 15px; vertical-align: top; text-align: right; width: 30%;">
                <div style="background-color: {% if announcement.days_left <= 1 %}#dc2626{% elif announcement.days_left <= 3 %}#d97706{% else %}#2563eb{% endif %}; color: white; padding: 8px 12px; border-radius: 4px; font-size: 12px; font-weight: bold;">
                    {% if announcement.days_left == 0 %}
                        ì˜¤ëŠ˜ ë§ˆê°!
                    {% elif announcement.days_left == 1 %}
                        ë‚´ì¼ ë§ˆê°
                    {% else %}
                        D-{{ announcement.days_left }}
                    {% endif %}
                </div>
            </td>
        </tr>
    </table>
</div>
{% endfor %}
{% endif %}

{% if not new_announcements and not deadline_announcements %}
<div style="text-align: center; padding: 40px 20px; color: #6b7280;">
    <h3 style="color: #9ca3af;">ğŸ“­ ì˜¤ëŠ˜ì€ ìƒˆë¡œìš´ ì†Œì‹ì´ ì—†ìŠµë‹ˆë‹¤</h3>
    <p>íšŒì›ë‹˜ì˜ ê´€ì‹¬ í‚¤ì›Œë“œì— ë§¤ì¹­ë˜ëŠ” ìƒˆë¡œìš´ ê³µê³ ë‚˜ ë§ˆê° ì„ë°• ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.<br>
    ë‚´ì¼ ë‹¤ì‹œ í™•ì¸í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤!</p>
</div>
{% endif %}

<hr style="border: none; border-top: 1px solid #e5e7eb; margin: 30px 0;">

<h3>ğŸ“Š ì´ë²ˆ ì£¼ í†µê³„</h3>
<div class="meta-info">
    <table>
        <tr>
            <td>ìƒˆë¡œ ë“±ë¡ëœ ê³µê³ </td>
            <td><strong>{{ stats.new_this_week or 0 }}ê±´</strong></td>
        </tr>
        <tr>
            <td>ë§¤ì¹­ëœ ê³µê³ </td>
            <td><strong>{{ stats.matched_this_week or 0 }}ê±´</strong></td>
        </tr>
        <tr>
            <td>ì´ë²ˆ ì£¼ ë§ˆê° ê³µê³ </td>
            <td><strong>{{ stats.deadline_this_week or 0 }}ê±´</strong></td>
        </tr>
        <tr>
            <td>ì¸ê¸° í‚¤ì›Œë“œ</td>
            <td>{{ stats.popular_keywords[:3] | join(', ') if stats.popular_keywords else 'ë°ì´í„° ë¶€ì¡±' }}</td>
        </tr>
    </table>
</div>

<div style="text-align: center; margin: 30px 0;">
    <a href="{{ dashboard_url }}" class="cta-button">
        ğŸ“ˆ ì „ì²´ ëŒ€ì‹œë³´ë“œ ë³´ê¸°
    </a>
</div>

<p style="font-size: 12px; color: #6b7280; margin-top: 30px;">
    * ì¼ê°„ ë‹¤ì´ì œìŠ¤íŠ¸ëŠ” íšŒì›ë‹˜ì˜ êµ¬ë… ì„¤ì •ì— ë”°ë¼ ë§¤ì¼ {{ digest_time }}ì— ë°œì†¡ë©ë‹ˆë‹¤.<br>
    * ë‹¤ì´ì œìŠ¤íŠ¸ ë°œì†¡ ì£¼ê¸°ëŠ” <a href="{{ notification_settings_url }}">ì•Œë¦¼ ì„¤ì •</a>ì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì¼ê°„/ì£¼ê°„/ì›”ê°„).<br>
    * ë” ë§ì€ ê³µê³ ë¥¼ ë³´ë ¤ë©´ <a href="{{ browse_url }}">ì „ì²´ ê³µê³  ë‘˜ëŸ¬ë³´ê¸°</a>ë¥¼ ì´ìš©í•´ ì£¼ì„¸ìš”.
</p>
{% endblock %}